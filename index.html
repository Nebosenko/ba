<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC æœŸæƒå…¨æ™¯ç›‘æ§ - ç»ˆææ–¹æ¡ˆ</title>
    <style>
        :root { --binance-yellow: #f0b90b; --bg: #0b0e11; --card: #1e2329; --call: #0ecb81; --put: #f6465d; --text: #eaecef; --border: #363c4e; }
        body { font-family: "PingFang SC", "Microsoft YaHei", sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .header h1 { font-size: 22px; color: var(--binance-yellow); margin: 0; }
        #status { font-size: 12px; color: #848e9c; }
        .loading { text-align: center; margin-top: 50px; color: #848e9c; font-size: 16px; line-height: 1.8; }
        .expiry-section { background: var(--card); border-radius: 8px; margin-bottom: 30px; border: 1px solid var(--border); overflow: hidden; }
        .expiry-header { background: #2b3139; padding: 12px 20px; font-weight: bold; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #161a1e; color: #848e9c; font-size: 11px; padding: 10px 5px; }
        td { padding: 8px 5px; text-align: center; border-bottom: 1px solid #2b3139; font-size: 13px; font-family: "Consolas", monospace; }
        .strike-col { background: #161a1e; font-weight: bold; color: #fff; width: 110px; border-left: 1px solid var(--border); border-right: 1px solid var(--border); }
        .call-side { color: var(--call); text-align: right; padding-right: 15px; }
        .put-side { color: var(--put); text-align: left; padding-left: 15px; }
        .greek { color: #848e9c; font-size: 11px; }
        .btn-retry { margin-top: 15px; padding: 8px 20px; background: var(--binance-yellow); border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <h1>BTC æœŸæƒå…¨æ™¯çœ‹æ¿</h1>
    <div id="status">å‡†å¤‡è¿æ¥...</div>
</div>

<div id="main-content">
    <div class="loading">
        ğŸ“¡ æ­£åœ¨ç»•è¿‡åŒºåŸŸé™åˆ¶å°è¯•è¿æ¥å¸å®‰ API...<br>
        é¦–æ¬¡åŠ è½½å¯èƒ½éœ€è¦ 5-10 ç§’ï¼Œè¯·ä¿æŒç½‘é¡µå¼€å¯ã€‚
    </div>
</div>

<script>
    // æ›¿æ¢ä¸ºæ‚¨åˆšåˆ›å»ºçš„ Cloudflare Worker ç½‘å€
    const WORKER_URL = "https://ba.yuanhua-mail.workers.dev";

    async function fetchData() {
        const statusEl = document.getElementById('status');
        try {
            const response = await fetch(WORKER_URL);
            if (!response.ok) throw new Error("Worker å“åº”é”™è¯¯: " + response.status);
            
            const data = await response.json();
            
            // ä¸‹é¢çš„é€»è¾‘ä¿æŒä¸å˜
            const btcOptions = data.filter(opt => opt.symbol && opt.symbol.startsWith('BTC-'));
            if (btcOptions.length === 0) throw new Error("æœªæ‰¾åˆ° BTC æœŸæƒæ•°æ®");

            const groups = {};
            btcOptions.forEach(opt => {
                const parts = opt.symbol.split('-'); 
                if (parts.length < 4) return;
                const expiry = parts[1];
                const strike = parts[2];
                const type = parts[3];

                if (!groups[expiry]) groups[expiry] = {};
                if (!groups[expiry][strike]) groups[expiry][strike] = { C: null, P: null };

                groups[expiry][strike][type] = {
                    price: parseFloat(opt.markPrice).toLocaleString(undefined, {minimumFractionDigits: 1}),
                    iv: (parseFloat(opt.markIV || opt.expiryIV || 0) * 100).toFixed(1) + '%',
                    delta: parseFloat(opt.delta || 0).toFixed(3)
                };
            });

            renderTable(groups);
            statusEl.innerText = 'æœ€ååŒæ­¥: ' + new Date().toLocaleTimeString();
        } catch (error) {
            document.getElementById('main-content').innerHTML = `
                <div class="loading">
                    <span style="color:#f6465d;">âŒ è¿æ¥å¤±è´¥: ${error.message}</span><br>
                    <button class="btn-retry" onclick="fetchData()">é‡è¯•</button>
                </div>`;
        }
    }
    // ... å…¶ä»–å‡½æ•°ä¿æŒä¸å˜ ...
    fetchData();
    setInterval(fetchData, 30000); 
</script>

</body>
</html>